schemaVersion: 2.1.0
metadata:
  name: nodejs
  displayName: Node.js Runtime
  description: Node.js 16 application
  icon: https://nodejs.org/static/images/logos/nodejs-new-pantone-black.svg
  tags:
    - Node.js
    - Express
    - ubi8
  projectType: Node.js
  language: JavaScript
  version: 2.1.1
  namespace: devspaces-vaaacserram
attributes:
  controller.devfile.io/devworkspace-config:
    name: devworkspace-config
    namespace: devspaces-openshift
  controller.devfile.io/scc: container-build
  controller.devfile.io/storage-type: per-workspace
  dw.metadata.annotations:
    che.eclipse.org/devfile-source: |
      scm:
        repo: https://github.com/marcosserranojr/NodeJs-Express-Frontend-StudentAPI.git
        fileName: devfile.yaml
      factory:
        params: >-
          url=https://github.com/marcosserranojr/NodeJs-Express-Frontend-StudentAPI.git
projects:
  - git:
      remotes:
        origin: https://github.com/marcosserranojr/NodeJs-Express-Frontend-StudentAPI.git
    name: nodejs-studentapi-frontend
components:
  - attributes:
      controller.devfile.io/merge-contribution: true
    container:
      endpoints:
        - exposure: public
          name: nodejs
          protocol: http
          targetPort: 3000
      env:       
        - name: OPENVSX_REGISTRY_URL
          value: https://open-vsx.org
        - name: NODE_EXTRA_CA_CERTS
          value: /public-certs/ca-certs.ca-bundle.crt
      image: quay.io/devfile/universal-developer-image:ubi8-latest
      memoryLimit: 1G
      mountSources: true
      sourceMapping: /projects
    name: tools
commands:
  - exec:
      commandLine: npm install
      component: tools
      group:
        isDefault: true
        kind: build
      label: Install dependencies
      workingDir: ${PROJECT_SOURCE}/app
    id: install-dependencies
  - exec:
      commandLine: node app.js
      component: tools
      group:
        kind: run
      label: Run web application
      workingDir: ${PROJECT_SOURCE}/app
    id: run-application
  - exec:
      commandLine: npm install --save-dev nodemon && npm start
      component: tools
      group:
        kind: run
      label: Run application with nodemon(DEV)
      workingDir: ${PROJECT_SOURCE}/app
    id: run-application-dev
  - exec:
      commandLine: node --inspect app.js
      component: tools
      group:       
        kind: debug
      label: Run web application (debugging enabled)
      workingDir: ${PROJECT_SOURCE}/app
    id: debug
  - exec:
      commandLine: 'node_server_pids=$(pgrep -fx ''.*node (--inspect )?app.js'' | tr "\\n" " ") && echo "Stopping node server with PIDs: ${node_server_pids}" &&  kill -15 ${node_server_pids} &>/dev/null && echo ''Done.'''
      component: tools
      group:
        kind: run
      label: Stop web application
    id: stop-application
